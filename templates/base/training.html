{% extends 'base.html' %}

{% load bootstrap4 %}
{% load i18n %}

{% block title %}{% trans "Training" %}{% endblock %}
{% block header %}{% trans "Training" %}{% endblock %}
{% block training_active %}active{% endblock %}
{% block body %}
<div class="row">
	<div class="col-sm-8">
		<table class="table table-bordered table-striped">
    		<thead class="thead-light">
    			<tr>
        			<th>{% trans "First name" %}</th>
        			<th>{% trans "Last name" %}</th>
        			<th>{% trans "Profile" %}</th>
        			<th>{% trans "Result" %}</th>
    			</tr>
    		</thead>
    		<tbody>
	  		</tbody>
		</table>
	</div>
	<div class="col-sm-4">
		<div class="card">
			<h2>{% trans "Read result:" %}</h2>
			<form method="" id="readForm" name="readForm" action="">
			{% bootstrap_form form %}
	        {% buttons %}
	            <button id="read-result" class="btn btn-primary">{% trans "Read" %}</button>
	        {% endbuttons %}
			<div id="progressbar" class="card border-success" style="display: none;">
				 <div class="card-header text-success">Please wait until the result is there</div>
				<div class="loader"></div>
			</div>
			{{ form.media }}
			</form>
		</div>
		<div class="card">
			<h2>{% trans "Monitor preview:" %}</h2>
			<img src="https://www.download-kostenlos.org/wp-content/zielscheibe-vorlage.jpg" alt="zielscheibe" width="340px" height="340px"/>
		</div>
	</div>
</div>
<script>
        var socket = new WebSocket(
        	'ws://' + window.location.host +
        	'/ws/read/');
        socket.onmessage = function(e) {
        	var data = JSON.parse(e.data);
        	if (data['success'])
        	{
        		alert("Success: " + data['message']);
        	}
        	else
        	{
        		alert("Failure: " + data['message']);
        	}
        	alert("Add message and reload Page");
        	socket.close();
        };
        socket.onclose = function(e) {
        	location.reload();
        };
        $("#readForm").submit(function(e){
			e.preventDefault();
			var profile = document.querySelector('#id_Profile').value;
        	var member = document.querySelector('#id_Member').value;
        	socket.send(JSON.stringify({
        		'profile': profile,
        		'member': member
        	}));
        	$("#read-result").hide();
        	$("#progressbar").show();
		});
    </script>
{% endblock %}